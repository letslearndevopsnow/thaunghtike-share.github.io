---
layout:     post
title:   "Managing User Accounts In Kubernetes"
date:       2021-08-17 15:13:18 +0200
image: 7.jpg
tags:
    - Kubernetes
    - Jenkins
    - CICD
categories: jenkins
---   
<h2> Introduction </h2>

ဒီနေ့ကျွန်တော်ရေးမယ့်အကြောင်းအရာကတော့ kubernetes ပေါ်မှာ user accouns တွေ manage လုပ်တဲ့အကြောင်းပဲဖြစ်ပါတယ်။ kubernetes မှာအခြေခံအားဖြင့် account types (၂)ခုကို နားလည်ဖို့လိုပါတယ်။ အဲ့ဒီ account (၂)မျိုးကတော့ service account နဲ့ user account တို့ပဲဖြစ်ပါတယ်။ service accounts ဆိုကတော့ အရိုးရှင်းဆုံးပြောရရင် kube API server နဲ့ authenticate လုပ်ဖို့လိုအပ်တဲ့ pods လို kubernetes resources တွေအတွက် create ပေးရတဲ့ account တွေပဲဖြစ်ပါတယ်။ service account အကြောင်းကို [official doc](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account) မှာဖတ်လို့ရပါတယ်။ user account ဆိုတာကတော့ ကျွန်တော်တို့ နားလည်ထားသလိုပါပဲ။ user account တွေကို admin က create ပေးမယ်။ ဒီ user ကတော့ ဘာလုပ်လို့ရမယ် ဘယ်လို permissions တွေသတ်မှတ်ပေးမယ် ..စသည်ဖြင့်ပေါ့။ kubernetes မှာလည်း user account ဆိုတာ cluster ကို access လုပ်ဖို့အတွက် အသုံးပြုမယ့် account တွေကို ဆိုလိုတာပါ။ အဲ့ဒီတော့ user account တွေကို စတင်မဆွေးနွေးခင်မှာ kubernetes ရဲ့ contexts တွေအကြောင်းကို အရင်ဆွေးနွေးပါရစေ။ 

<h2> Kubernetes Contexts </h2>

ကျွန်တော်တို့ kubeadm နဲ့ kubernetes cluster တစ်ခုကို create လုပ်ပြီးပြီဆိုရင် /etc/kubernetes အောက်မှာရှိတဲ့ admin.config ကို ~/.kube အောက်က config ထဲကို copy ကူးပြီး kubeconfig file တစ်ခု create လုပ်ပေးရပါတယ်။ ဒါမှသာ kubectl နဲ့ command တွေကို execute လုပ်တဲ့အခါ kubeconfigfile ကနေ current context ကိုစစ်မယ်။ ပြီးမှ cluster information ကနေ kube apiserver ကိုအလုပ်သွားလုပ်မှာဖြစ်ပါတယ်။ ~/.kube က kubeconfig ကိုသိမ်းဖို့အတွက် default location လည်းဖြစ်တယ်။ ဒါကြောင့် kubectl get nodes/pods ဘာညာနဲ့  ခေါ်လိုက်ရင် kubeapi server ကိုအလုပ်သွားလုပ်တာပါ။ ~/.kube အောက်မှာသာ  config မရှိရင် kubectl get nodes/pods --kubeconfig /path/config ဆိုပြီး config ရဲ့ path လမ်းကြောင်းကိုသတ်မှတ်ပေးရမှာပါ။ အဲ့ဒီ ~/.kube/config ထဲမှာရှိတဲ့ အရာတွေကို contexts တွေလို့ခေါ်ပါတယ်။ kubernetes admin တစ်ယောက်က context တွေကို ပိုင်နိုင်စွာအသုံးပြုတတ်ဖို့လိုပါတယ်။ configfile ထဲမှာ default အားဖြင့်တော့ contexts တစ်ခုပဲရှိမှာပါ။ သို့သော် cluster တွေအများကြီးကို control အတွက်လုပ်ဖို့အတွက်ဆို config ထဲမှာ contexts တွေအများကြီးရှိနိုင်ပါတယ်။ ဆိုလိုတာက config ထဲမှာ cluster တစ်ခုထက်ပိုပြီး cluster information တွေ user information တွေရှုပ်နိုင်ပါတယ်။ မသိသေးတဲ့လူတွေအတွက်အခုချိန် ရှုပ်နေနိုင်မှာပါ။ အဆုံးထိဖတ်ပေးဖို့ တောင်းဆိုချင်ပါတယ်။ ဒါဆို အခုပဲ kubeconfig file နဲ့ contexts အကြောင်းကို demo လေးတစ်ခုနဲ့ရှင်းပြလိုက်ပါမယ်။

<h2> Playing with Kubeconfig & Contexts </h2>

အရင်ဆုံး kubeadm နဲ့ kubernetes cluster တစ်ခုကို create လိုက်ဖို့လိုပါမယ်။ kubernetes cluster create လုပ်ပုံကိုတော့ [ဒီမှာ]() ကြည့်နိုင်ပါတယ်။ worker nodes တွေ master ကို join ပြီးပြီဆိုရင် /etc/kubernetes အောက်က admin.config ကို ~/.kube/config ထဲကို copy ကူးထည့်လိုက်ပါ။ ပြီးသွားရင်တော့ kubectl get nodes -o wide နဲ့ cluster ရဲ့ nodes တွေကို ကြည့်နိုင်ပါတယ်။ 

